<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Mosquitto Websockets</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		
		<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'  type='text/css'>
		
		<script src="mqttws31.js" type="text/javascript"></script>
		<script src="https://code.jquery.com/jquery-3.3.1.js"integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src="config.js" type="text/javascript"></script>
		<link href="WaterLevelStyles.css" rel="stylesheet" type="text/css"/>
		
		<script type="text/javascript">
			var mqtt;
			var reconnectTimeout = 2000;
			var Timestamp;

			function MQTTconnect() {
			if (typeof path == "undefined") {
				path = '/mqtt';
			}
			mqtt = new Paho.MQTT.Client(
					host,
					port,
					path,
					"web_" + parseInt(Math.random() * 100, 10)
			);
				var options = {
					timeout: 3,
					useSSL: useTLS,
					cleanSession: cleansession,
					onSuccess: onConnect,
					onFailure: function (message) {
						$('#status').val("Connection failed: " + message.errorMessage + "Retrying");
						setTimeout(MQTTconnect, reconnectTimeout);
					}
				};

				mqtt.onConnectionLost = onConnectionLost;
				mqtt.onMessageArrived = onMessageArrived;

				if (username != null) {
					options.userName = username;
					options.password = password;
				}
				//console.log("Host="+ host + ", port=" + port + ", path=" + path + " TLS = " + useTLS + " username=" + username + " password=" + password);
				mqtt.connect(options);
			}

			//Called when successfully connected to MQTT_Broker
			function onConnect() {	
				mqtt.subscribe(moisture_topic, {qos: 0});
				$('#status').val('Connected to ' + host + ':' + port + path);
				
				
			}

			//Called if web client lost tconnection to the MQTT_Broker
			function onConnectionLost(response) {
				setTimeout(MQTTconnect, reconnectTimeout);
				$('#status').val("connection lost: " + responseObject.errorMessage + ". Reconnecting");

			};

			//Called if any message arrives
			function onMessageArrived(message) {
				var topic = message.destinationName;
				var payload = message.payloadString;
				var moisture = parseInt(payload)+3;
				
				if(topic == moisture_topic) {
					//$('#ws').prepend('<li>' + moisture + '</li>');
					document.getElementById("myRange").value = moisture;
				}
				//Print additional information
				//$('#ws').prepend('<li>' + topic + ' = ' + payload + '</li>');
			};

			
			
			$(document).ready(function() {
				MQTTconnect();
			});
		</script>
	</head>

	<body>
	
		<ul class="topnav">
		  <li><a href="index.html">LED Stripe</a></li>
		  <li><a class="active" href="Water_Level.html">Water Level</a></li>
		  <li><a href="#contact">Curtoins</a></li>
		  <li class="right"><a href="#about">Status</a></li>
		</ul>
	
	
		<div class="a">
			<h1 style="font-size:430%;">Water Level</h1>
		</div>
    
			
		<div>
		<ul id='ws' style="font-family: 'Courier New', Courier, monospace;"></ul>
			Status: <input type='text' id='status' size="32" disabled />
		</div> 
		
		<br style="clear:both" />
		
		<div id="outer">  

			
		
			<div id="inner" class="container">	
		
				<input type="range" id="myRange" name="volume" min="0" max="45" value="25" step="1" />
			</div>	
		</div>
	
		
		
		
		
	</body>
</html>
